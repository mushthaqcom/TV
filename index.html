<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online TV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        .channel-item:hover {
            background-color: #1f2937;
        }
        .channel-item.active {
            background-color: #3b82f6;
        }
        .sidebar-toggle {
            transition: transform 0.3s ease;
        }
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 50;
                height: 100vh;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans overflow-hidden h-screen">
    <!-- Header -->
    <header class="bg-gray-800 p-4 flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <button id="sidebarToggle" class="md:hidden text-white hover:text-blue-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <h1 class="text-2xl font-bold text-blue-400">📺 Online TV</h1>
        </div>
        <div class="text-sm text-gray-300" id="currentChannel">Loading channels...</div>
    </header>

    <div class="flex" style="height: calc(100vh - 4rem);">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar sidebar-toggle bg-gray-800 w-80 overflow-y-auto border-r border-gray-700 md:translate-x-0">
            <div class="p-4">
                <h2 class="text-lg font-semibold mb-4 text-blue-400">📋 Channels</h2>
                <div id="channelList" class="space-y-2">
                    <div class="text-center py-8 text-gray-400">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-2"></div>
                        Loading channels...
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Video Player -->
            <div class="bg-black relative" style="height: calc(100vh - 8rem);">
                <video 
                    id="videoPlayer" 
                    class="w-full h-full object-contain" 
                    autoplay 
                    muted
                    poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%23111827'/%3E%3Ctext x='200' y='150' text-anchor='middle' fill='%236b7280' font-family='Arial' font-size='24'%3ESelect a channel to start%3C/text%3E%3C/svg%3E">
                    Your browser does not support the video tag.
                </video>
                
                <!-- Loading overlay -->
                <div id="loadingOverlay" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"></div>
                        <p class="text-white">Loading channel...</p>
                    </div>
                </div>

                <!-- Error overlay -->
                <div id="errorOverlay" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
                    <div class="text-center p-8">
                        <div class="text-red-400 text-6xl mb-4">⚠️</div>
                        <p class="text-white text-lg mb-4">Unable to load this channel</p>
                        <button id="retryButton" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg text-white">
                            Try Again
                        </button>
                    </div>
                </div>
            </div>

            <!-- Desktop Player Controls -->
            <div class="bg-gray-800 p-6 flex items-center justify-center space-x-6 hidden md:flex">
                <button id="prevChannel" class="bg-blue-600 hover:bg-blue-700 px-8 py-4 rounded-xl text-lg font-semibold transition-colors">
                    ⏮️ Previous Channel
                </button>
                <button id="playStopButton" class="bg-green-600 hover:bg-green-700 px-8 py-4 rounded-xl text-lg font-semibold transition-colors">
                    ⏸️ Stop
                </button>
                <button id="nextChannel" class="bg-blue-600 hover:bg-blue-700 px-8 py-4 rounded-xl text-lg font-semibold transition-colors">
                    Next Channel ⏭️
                </button>
                <button id="muteButton" class="bg-red-600 hover:bg-red-700 px-8 py-4 rounded-xl text-lg font-semibold transition-colors">
                    🔊 Mute
                </button>
            </div>

            <!-- Mobile Player Controls -->
            <div class="bg-gray-800 p-4 flex md:hidden items-center justify-center space-x-4">
                <button id="prevChannelMobile" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl text-lg font-semibold transition-colors">
                    ⏮️ Previous
                </button>
                <button id="playStopButtonMobile" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-xl text-lg font-semibold transition-colors">
                    ⏸️ Stop
                </button>
                <button id="nextChannelMobile" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl text-lg font-semibold transition-colors">
                    Next ⏭️
                </button>
                <button id="muteButtonMobile" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-xl text-lg font-semibold transition-colors">
                    🔊 Mute
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile overlay -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

    <script>
        class TVPlayer {
            constructor() {
                this.channels = [];
                this.currentChannelIndex = 0;
                this.player = document.getElementById('videoPlayer');
                this.channelList = document.getElementById('channelList');
                this.currentChannelDisplay = document.getElementById('currentChannel');
                this.loadingOverlay = document.getElementById('loadingOverlay');
                this.errorOverlay = document.getElementById('errorOverlay');
                this.sidebar = document.getElementById('sidebar');
                this.mobileOverlay = document.getElementById('mobileOverlay');
                this.hls = null;
                
                this.initializeEventListeners();
                this.loadPlaylist();
            }

            initializeEventListeners() {
                // Sidebar toggle for mobile
                document.getElementById('sidebarToggle').addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // Mobile overlay click
                this.mobileOverlay.addEventListener('click', () => {
                    this.closeSidebar();
                });

                // Channel navigation
                document.getElementById('prevChannel').addEventListener('click', () => {
                    this.previousChannel();
                });

                document.getElementById('nextChannel').addEventListener('click', () => {
                    this.nextChannel();
                });

                // Desktop Player controls
                document.getElementById('muteButton').addEventListener('click', () => {
                    this.toggleMute();
                });

                document.getElementById('playStopButton').addEventListener('click', () => {
                    this.togglePlayStop();
                });

                // Mobile Player controls
                document.getElementById('muteButtonMobile').addEventListener('click', () => {
                    this.toggleMute();
                });

                document.getElementById('playStopButtonMobile').addEventListener('click', () => {
                    this.togglePlayStop();
                });

                document.getElementById('prevChannelMobile').addEventListener('click', () => {
                    this.previousChannel();
                });

                document.getElementById('nextChannelMobile').addEventListener('click', () => {
                    this.nextChannel();
                });

                document.getElementById('retryButton').addEventListener('click', () => {
                    this.playCurrentChannel();
                });

                // Video events
                this.player.addEventListener('loadstart', () => {
                    this.showLoading();
                });

                this.player.addEventListener('canplay', () => {
                    this.hideOverlays();
                });

                this.player.addEventListener('error', () => {
                    this.showError();
                });

                this.player.addEventListener('play', () => {
                    document.getElementById('playStopButton').innerHTML = '⏸️ Stop';
                    document.getElementById('playStopButtonMobile').innerHTML = '⏸️ Stop';
                });

                this.player.addEventListener('pause', () => {
                    document.getElementById('playStopButton').innerHTML = '▶️ Play';
                    document.getElementById('playStopButtonMobile').innerHTML = '▶️ Play';
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowUp':
                            e.preventDefault();
                            this.previousChannel();
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.nextChannel();
                            break;
                        case ' ':
                            e.preventDefault();
                            this.player.paused ? this.player.play() : this.player.pause();
                            break;
                        case 'f':
                            this.toggleFullscreen();
                            break;
                        case 'm':
                            this.toggleMute();
                            break;
                    }
                });
            }

            async loadPlaylist() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/mushthaqcom/tv/refs/heads/main/tv.m3u');
                    const playlistText = await response.text();
                    this.parseM3U(playlistText);
                    this.renderChannelList();
                    if (this.channels.length > 0) {
                        this.playCurrentChannel();
                    }
                } catch (error) {
                    console.error('Error loading playlist:', error);
                    this.channelList.innerHTML = `
                        <div class="text-center py-8 text-red-400">
                            <div class="text-4xl mb-2">❌</div>
                            <p>Failed to load channels</p>
                            <button onclick="location.reload()" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-white">
                                Retry
                            </button>
                        </div>
                    `;
                }
            }

            parseM3U(content) {
                const lines = content.split('\n');
                this.channels = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line.startsWith('#EXTINF:')) {
                        const nameMatch = line.match(/,(.+)$/);
                        const name = nameMatch ? nameMatch[1].trim() : 'Unknown Channel';
                        
                        // Get the next non-empty line as URL
                        let url = '';
                        for (let j = i + 1; j < lines.length; j++) {
                            const nextLine = lines[j].trim();
                            if (nextLine && !nextLine.startsWith('#')) {
                                url = nextLine;
                                break;
                            }
                        }
                        
                        if (url) {
                            this.channels.push({ name, url });
                        }
                    }
                }
            }

            renderChannelList() {
                if (this.channels.length === 0) {
                    this.channelList.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <div class="text-4xl mb-2">📺</div>
                            <p>No channels found</p>
                        </div>
                    `;
                    return;
                }

                this.channelList.innerHTML = this.channels.map((channel, index) => `
                    <div class="channel-item p-3 rounded-lg cursor-pointer transition-colors ${index === this.currentChannelIndex ? 'active' : ''}" 
                         data-index="${index}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-sm font-bold">
                                ${index + 1}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium truncate">${channel.name}</div>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Add click listeners to channel items
                this.channelList.querySelectorAll('.channel-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const index = parseInt(item.dataset.index);
                        this.selectChannel(index);
                        this.closeSidebar();
                    });
                });
            }

            selectChannel(index) {
                if (index >= 0 && index < this.channels.length) {
                    this.currentChannelIndex = index;
                    this.updateActiveChannel();
                    this.playCurrentChannel();
                }
            }

            updateActiveChannel() {
                this.channelList.querySelectorAll('.channel-item').forEach((item, index) => {
                    item.classList.toggle('active', index === this.currentChannelIndex);
                });
                
                if (this.channels[this.currentChannelIndex]) {
                    this.currentChannelDisplay.textContent = this.channels[this.currentChannelIndex].name;
                }
            }

            playCurrentChannel() {
                if (this.channels.length === 0) return;
                
                const channel = this.channels[this.currentChannelIndex];
                this.updateActiveChannel();
                
                // Clean up previous HLS instance
                if (this.hls) {
                    this.hls.destroy();
                    this.hls = null;
                }
                
                // Check if the URL is an HLS stream (.m3u8)
                if (channel.url.includes('.m3u8') || channel.url.includes('m3u8')) {
                    if (Hls.isSupported()) {
                        // Use HLS.js for HLS streams
                        this.hls = new Hls({
                            enableWorker: true,
                            lowLatencyMode: true,
                            backBufferLength: 90
                        });
                        
                        this.hls.loadSource(channel.url);
                        this.hls.attachMedia(this.player);
                        
                        this.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            this.player.play().catch(error => {
                                console.log('Auto-play prevented:', error);
                            });
                        });
                        
                        this.hls.on(Hls.Events.ERROR, (event, data) => {
                            console.error('HLS Error:', data);
                            if (data.fatal) {
                                this.showError();
                            }
                        });
                    } else if (this.player.canPlayType('application/vnd.apple.mpegurl')) {
                        // Native HLS support (Safari)
                        this.player.src = channel.url;
                        this.player.load();
                        this.player.play().catch(error => {
                            console.log('Auto-play prevented:', error);
                        });
                    } else {
                        console.error('HLS not supported');
                        this.showError();
                    }
                } else {
                    // Regular video file
                    this.player.src = channel.url;
                    this.player.load();
                    this.player.play().catch(error => {
                        console.log('Auto-play prevented:', error);
                    });
                }
            }

            previousChannel() {
                if (this.channels.length === 0) return;
                this.currentChannelIndex = (this.currentChannelIndex - 1 + this.channels.length) % this.channels.length;
                this.playCurrentChannel();
            }

            nextChannel() {
                if (this.channels.length === 0) return;
                this.currentChannelIndex = (this.currentChannelIndex + 1) % this.channels.length;
                this.playCurrentChannel();
            }

            toggleMute() {
                this.player.muted = !this.player.muted;
                const muteIcon = this.player.muted ? '🔇' : '🔊';
                const muteText = this.player.muted ? 'Unmute' : 'Mute';
                document.getElementById('muteButton').innerHTML = `${muteIcon} ${muteText}`;
                document.getElementById('muteButtonMobile').innerHTML = `${muteIcon} ${muteText}`;
            }

            togglePlayStop() {
                if (this.player.paused) {
                    this.player.play().catch(error => {
                        console.log('Play error:', error);
                    });
                    document.getElementById('playStopButton').innerHTML = '⏸️ Stop';
                    document.getElementById('playStopButtonMobile').innerHTML = '⏸️ Stop';
                } else {
                    this.player.pause();
                    document.getElementById('playStopButton').innerHTML = '▶️ Play';
                    document.getElementById('playStopButtonMobile').innerHTML = '▶️ Play';
                }
            }

            toggleSidebar() {
                this.sidebar.classList.toggle('sidebar-hidden');
                this.mobileOverlay.classList.toggle('hidden');
            }

            closeSidebar() {
                this.sidebar.classList.add('sidebar-hidden');
                this.mobileOverlay.classList.add('hidden');
            }

            showLoading() {
                this.loadingOverlay.classList.remove('hidden');
                this.errorOverlay.classList.add('hidden');
            }

            showError() {
                this.loadingOverlay.classList.add('hidden');
                this.errorOverlay.classList.remove('hidden');
            }

            hideOverlays() {
                this.loadingOverlay.classList.add('hidden');
                this.errorOverlay.classList.add('hidden');
            }
        }

        // Initialize the TV player when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new TVPlayer();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c0fd38a51eac03',t:'MTc1NzM2MTE3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
